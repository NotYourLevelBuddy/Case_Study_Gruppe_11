# Aufgabe 1 - Logistik spielt in der Produktentwicklung der Automobilindustrie eine immer größer werdende Rolle. So müssen vom Lieferanten produzierte Teile zunächst zum OEM geliefert werden, bevor sie eingebaut werden können. Was auf den ersten Blick logisch erscheint, sollte für eine professionelle Organisation unbedingt näher analysiert werden. Erstellen Sie deshalb eine Verteilung für den Logistikverzug von Komponente „K7“. Nutzen Sie hierfür das Produktionsdatum aus dem Datensatz “Komponente_K7.csv” und das Wareneingangsdatum aus “Logistikverzug_K7.csv”. Sie können davon ausgehen, dass der Hersteller das Teil am auf den Produktionstag folgenden Werktag an die Logistikabteilung übergibt. Für die Versandvorbereitung wird ein Werktag benötig. Erstellen Sie für die Modellbildung in R einen neuen Datensatz “Logistikverzug”, der die benötigten Informationen aus beiden Datensätzen enthält. Wie ist der Logistikverzug verteilt? Begründen Sie Ihre Auswahl und stellen Sie Ihre Vorgehensweise kurz dar (6 Punkte). Wie viel Zeit vergeht mindestens/höchstens zwischen Warenausgang und Wareneingang (2 Punkte)? Bestimmen Sie den Mittelwert des Logistikverzugs (1 Punkt). Stellen Sie die Verteilung in geeigneter Weise mit Plotly dar (2 Punkte).


install.packages("dplyr")
install.packages("lubridate")
install.packages("ggplot2")
install.packages("stringr")
install.packages("knitr")

library(dplyr)
library(lubridate)
library(ggplot2)

#Zunächst müssen zwei Excel-Dokumente eingelesen werden, um sie für weitere Berechnungen zu einem Dokument zusammenzufassen. 
komponente_k7 <- read.csv(".\\Data\\Logistikverzug\\Komponente_K7.csv", sep=";")
logistikverzug_k7 <- read.csv(".\\Data\\Logistikverzug\\Logistikverzug_K7.csv", sep=";")

# Zusammenführung der Datenrahmen anhand der IDNummer
gesamt_df <- merge(komponente_k7, logistikverzug_k7, by.x="IDNummer", by.y="IDNummer")

# Datumsumwandlung für die Berechnung des Logistikverzugs
gesamt_df$Produktionsdatum <- as.Date(gesamt_df$Produktionsdatum, format = "%Y-%m-%d")
gesamt_df$Wareneingang <- as.Date(gesamt_df$Wareneingang, format = "%d.%m.%Y")

# Berechnung des Logistikverzugs in Tagen (unter Berücksichtigung eines weiteren Tags für Versandvorbereitung). Angenommen wurde, dass vom Zeitpunkt der Produktion bis zur Übergabe der Waren an die Logistik ein Tag vergeht und ein weiterer Tag für die Vorbereitung der Waren für den Versand benötigt wird. Um den Versandtag zu berechnen, müssen also zwei Tage zum Tag der Produktion der Waren hinzugezählt werden.
gesamt_df <- gesamt_df %>%
  mutate(Logistikverzug = as.numeric(difftime(Wareneingang, Produktionsdatum + days(2), units = "days")))  # Plus 2 Tage für Lieferungvorbereitung und Versandvorbereitung

# Minimaler Zeitunterschied zwischen Warenausgang und Wareneingang
min_zeit <- min(gesamt_df$Logistikverzug, na.rm = TRUE)

# Maximaler Zeitunterschied zwischen Warenausgang und Wareneingang
max_zeit <- max(gesamt_df$Logistikverzug, na.rm = TRUE)

# Ausgabe der Ergebnisse
cat("Minimale Zeitunterschied zwischen Warenausgang und Wareneingang:", min_zeit, "Tage\n")
cat("Maximale Zeitunterschied zwischen Warenausgang und Wareneingang:", max_zeit, "Tage\n")

# Mittelwert des Logistikverzugs berechnen
mittelwert_logistikverzug <- mean(gesamt_df$Logistikverzug, na.rm = TRUE)

# Ausgabe des Mittelwerts
cat("Mittelwert des Logistikverzugs:", mittelwert_logistikverzug, "Tage\n")

# Histogramm des Logistikverzugs erstellen
ggplot(gesamt_df, aes(x=Logistikverzug)) +
  geom_histogram(binwidth=1, fill="blue", color="black") +
  theme_minimal() +
  labs(title="Verteilung des Logistikverzugs für Komponente K7",
       x="Logistikverzug (Tage)",
       y="Häufigkeit")
       
       
       
       
       
       

#Aufgabe 2 - Warum ist es sinnvoll, die Ihnen bereitgestellten Daten in separaten Dateien abzulegen und nicht alles in einer riesigen Tabelle abzuspeichern (4 Argumente)? Wie nennt sich das zugrunde liegende Datenbankkonzept? (3 Punkte) 


#SIEHE DAZU HTML DOKUMENT







#Aufgabe 3 - Wie viele der Komponenten K7 landeten in Fahrzeugen, die in Wehr, Landkreis Waldshut zugelassen wurden? (3 Punkte)


if (!require("stringr")) install.packages("stringr")

# Define and read the file
zulassungen_data <- read.csv("C:\\Users\\aylar\\OneDrive\\Desktop\\ida WiSe2024\\Zulassungen\\Zulassungen_alle_Fahrzeuge.csv", sep=";")

# Filter rows where the column Gemeinden is 'WEHR' or other variations like WEHR1 etc.
wehr_data <- filter(zulassungen_data, str_detect(Gemeinden, "^WEHR\\d*$|^WEHR$"))

# Get the IDNummer from the filtered data
wehr_ids <- wehr_data$IDNummer

# Define the path to the second file
fahrzeug_data <- read.csv("C:\\Users\\aylar\\OneDrive\\Desktop\\ida WiSe2024\\Fahrzeug\\Bestandteile_Fahrzeuge_OEM2_Typ22.csv", sep=";")

# Find matches in the second file
matched_fahrzeug <- fahrzeug_data[fahrzeug_data$ID_Fahrzeug %in% wehr_ids,]

# Get the ID_Karosserie from the matched data
karosserie_ids <- matched_fahrzeug$ID_Karosserie

# Define the path to the third file
komponente_data <- read.csv("C:\\Users\\aylar\\OneDrive\\Desktop\\ida WiSe2024\\Logistikverzug\\Komponente_K7.csv", sep=";")

# Find matches in the third file
final_matches <- komponente_data[komponente_data$IDNummer %in% karosserie_ids,]

# Count the matches
total_matches <- nrow(final_matches)

# Concatenate the IDs of the found components into a single string with German text
gefundene_komponenten_string <- paste("Gefundene Komponenten IDs: ", paste(final_matches$IDNummer, collapse = ", "))

# Print all found component IDs with the corresponding German text
print(gefundene_komponenten_string)

# Output the total number of matches with German text
print(paste("Anzahl der in Wehr, Landkreis Waldshut zugelassenen Fahrzeuge mit Komponenten K7: ", total_matches))








#Aufgabe 4 - Welche Datentypen haben die Attribute der Zulassungstabelle „Zulassungen_aller_Fahrzeuge“? Erstellen Sie dazu eine Tabelle in Markdown.


# Installieren des knitr-Pakets
if (!require(knitr)) {
  install.packages("knitr")
}

# Laden des knitr-Pakets
library(knitr)

# Daten aus der CSV-Datei lesen
daten <- read.csv("C:\\Users\\aylar\\OneDrive\\Desktop\\ida WiSe2024\\Zulassungen\\Zulassungen_alle_Fahrzeuge.csv", sep=";")

# Typen der Daten für jede Spalte bestimmen
datentypen <- sapply(daten, class)

# Umwandlung der Datentypen in verständlichere Bezeichnungen
datentypen <- gsub("integer", "Integer", datentypen)
datentypen <- gsub("character", "String", datentypen)
datentypen <- gsub("factor", "Faktor", datentypen)
datentypen <- gsub("numeric", "Numerisch", datentypen)
datentypen <- gsub("logical", "Logisch", datentypen)
datentypen <- gsub("Date", "Datum", datentypen)

# Erstellen einer Tabelle für die Ausgabe
ausgabeDaten <- data.frame(Attribut = names(datentypen), Datentyp = datentypen, row.names = NULL)

# Ausgabe der Tabelle in einem schönen Format
kable(ausgabeDaten, format = "markdown", col.names = c("Attribut", "Datentyp"), row.names = FALSE)


#Nach der Ausführung dieses Codes analysiert R jede Spalte und gibt den entsprechenden Attributtyp in einer Tabelle aus, die letztendlich wie folgt aussieht: 


<!-- |Attribut  |Datentyp | -->
<!-- |:---------|:--------| -->
<!-- |X         |Integer  | -->
<!-- |IDNummer  |String   | -->
<!-- |Gemeinden |String   | -->
<!-- |Zulassung |String   | -->



#Aufgabe 5 - Sie wollen Ihre Applikation veröffentlichen. Warum ist es gerade dann sinnvoll die Datensätze auf der Datenbank eines Servers abzulegen? Warum können Sie die Datensätze nicht auf Ihrem persönlichen Computer ablegen? Nennen Sie eine einfache Möglichkeit Ihre Applikation ihrem Kundenkreis zugänglich zu machen? (2 Argumente je Frage, insg. 3 Punkte)

#SIEHE DAZU HTML DOKUMENT







#Aufgabe 6 - Am 11.08.2010 hat es einen Unfall mit Fahrerflucht gegeben. Von dem Kennzeichen des Unfallwagens fehlt jede Spur. Da Sie für das Kraftfahrtbundesamt arbeiten und fragt bittet Sie die Polizei um Mithilfe. Finden Sie heraus, wo das Fahrzeug mit der Karosseriebauteilnummer „K7-114-1142-31“ zugelassen wurde. (3 Punkte)

#Unter der Annahme, dass wir nur ID_Karosserie als Eingabe haben, sollten wir diese verwenden, um nach dem Fahrzeug selbst zu suchen. Da alle ID_Karosserien für die 7 Karosserien in der Tabelle Bestandteile_Fahrzeuge_OEM2_Typ22 gespeichert sind, können wir diese Tabelle durchsuchen, um das entsprechende ID_Fahrzeug zu finden. Nachdem wir diese Nummer gefunden haben, können wir leicht herausfinden, wo dieses Auto zugelassen war.

# Laden der Fahrzeugdaten
fahrzeug_data <- read.csv("C:\\Users\\aylar\\OneDrive\\Desktop\\ida WiSe2024\\Fahrzeug\\Bestandteile_Fahrzeuge_OEM2_Typ22.csv", sep=";")
# Laden der Zulassungsdaten
zulassungen_data <- read.csv("C:\\Users\\aylar\\OneDrive\\Desktop\\ida WiSe2024\\Zulassungen\\Zulassungen_alle_Fahrzeuge.csv", sep=";")

# Finden der Fahrzeuge mit der spezifischen Karosserienummer
matching_fahrzeuge <- filter(fahrzeug_data, ID_Karosserie == "K7-114-1142-31")

fahrzeug_ids <- matching_fahrzeuge$ID_Fahrzeug

# Bestimmen der Zulassungsstadt basierend auf den Fahrzeug-IDs
matching_zulassungen <- zulassungen_data[zulassungen_data$IDNummer %in% fahrzeug_ids,]
registration_cities <- matching_zulassungen$Gemeinden

# Ausgabe der Zulassungsstadt mit einer erklärenden Nachricht
if (length(registration_cities) > 0) {
  cat("Das Fahrzeug mit der Karosseriebauteilnummer 'K7-114-1142-31' wurde in folgenden Städten zugelassen:", paste(registration_cities, collapse=", "), ".\n")
} else {
  cat("Keine Zulassungsdaten für das Fahrzeug mit der Karosseriebauteilnummer 'K7-114-1142-31' gefunden.\n")
}
